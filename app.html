
<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>Lune Beauty — Skin AI (DermAlidaBeauty Luxe v1 Merge)</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Playfair+Display:wght@500;600;700&display=swap" rel="stylesheet"/>
  <style>
  :root{
    --sand:#FBF8F4; --gold:#C8A34A; --white:#ffffff; --slate:#151515; --beige:#F4EEDF; --soft-gray:#f5f4f2; --radius:16px; --shadow:0 12px 34px rgba(0,0,0,.08);
    --ok:#16a34a; --warn:#f59e0b; --bad:#dc2626;
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{margin:0;background:var(--sand);color:var(--slate);font-family:Inter,system-ui,sans-serif;-webkit-font-smoothing:antialiased}
  h1,h2,h3{font-family:"Playfair Display",serif}
  button{cursor:pointer}
  /* NAV */
  .nav{position:sticky;top:0;z-index:20;background:rgba(255,255,255,.85);backdrop-filter:saturate(1.1) blur(10px);border-bottom:1px solid #eee}
  .nav .inner{max-width:1100px;margin:0 auto;padding:10px 18px;display:flex;align-items:center;gap:14px}
  .brand{display:flex;align-items:center;gap:10px}
  .brand .logo{width:28px;height:28px;display:inline-block;background:transparent url('assets/img/logo.png') center/contain no-repeat;border-radius:6px}
  .brand .wordmark{font-family:"Playfair Display",serif;font-size:20px;letter-spacing:.3px}
  .nav-spacer{flex:1}
  .nav-links{display:flex;gap:12px;align-items:center}
  .nav-links a{color:#333;text-decoration:none;font-weight:600}
  .nav-links a:hover{color:var(--gold)}

  /* Splash */
  #splash{min-height:calc(100vh - 56px);display:flex;flex-direction:column;align-items:center;justify-content:center;text-align:center;padding:36px;background:radial-gradient(80% 60% at 50% 40%, #fff 0%, rgba(251,248,244,.9) 65%, rgba(200,163,74,.08) 100%)}
  #splash .logo-big{width:120px;height:120px;border-radius:18px;background:transparent url('assets/img/logo.png') center/contain no-repeat;margin:0 auto 14px;box-shadow:0 10px 28px rgba(200,163,74,.22)}
  #splash .tag{font-size:18px;opacity:.8;margin:8px 0 16px}

  /* Buttons */
  .btn{padding:12px 22px;border-radius:12px;border:none;font-weight:600;font-size:15px;transition:transform .26s ease, box-shadow .26s ease, opacity .26s ease}
  .btn:disabled{opacity:.6;cursor:not-allowed}
  .btn-primary{position:relative;color:#111;background:linear-gradient(90deg,var(--gold),#EED9A6);box-shadow:var(--shadow);overflow:hidden}
  .btn-primary::before{content:"";position:absolute;inset:0;background:linear-gradient(120deg,transparent,rgba(255,255,255,.35),transparent);transform:translateX(-120%);}
  .btn-primary:hover::before{animation:sheen 650ms ease}
  @keyframes sheen{to{transform:translateX(120%)}}
  .btn-secondary{background:#fff;border:1px solid #e8e8e8;color:var(--slate)}

  /* Admin discreet button bottom-center */
  #adminHiddenBtn{position:fixed;left:50%;bottom:20px;transform:translateX(-50%);font-family:"Playfair Display",serif;font-size:12px;letter-spacing:.3px;color:var(--slate);opacity:.18;padding:6px 12px;border-radius:8px;backdrop-filter:blur(4px);transition:opacity .26s ease, transform .26s ease, color .26s ease;z-index:40}
  #adminHiddenBtn:hover{opacity:.55;color:var(--gold);transform:translateX(-50%) scale(1.02)}
  #adminHiddenBtn:active{opacity:.8;transform:translateX(-50%) scale(.98)}
  #adminHiddenBtn::after{content:"";position:absolute;left:50%;bottom:-2px;width:0%;height:1.5px;background:linear-gradient(90deg,var(--gold),#EED9A6);transition:width .3s ease;transform:translateX(-50%)}
  #adminHiddenBtn:hover::after{width:60%}

  /* App container */
  #app{display:none;max-width:1100px;margin:0 auto;padding:24px}
  /* Progress */
  #progressBar{height:6px;background:var(--beige);border-radius:6px;overflow:hidden}
  #progressFill{height:6px;width:0;background:linear-gradient(90deg,var(--gold),#EED9A6)}
  #progressWrap{margin:12px 0 20px}

  /* Screens */
  .screen{display:none;background:#fff;padding:24px;border-radius:var(--radius);box-shadow:var(--shadow);animation:panelIn .34s ease both}
  @keyframes panelIn{from{opacity:0;transform:translateY(12px)} to{opacity:1;transform:translateY(0)}}
  label{display:block;font-weight:600;margin-bottom:6px}
  input, textarea, select{width:100%;padding:12px;border-radius:12px;border:1px solid #e5e5e5}
  textarea{resize:vertical}
  .row{display:grid;gap:16px}
  .row-2{grid-template-columns:repeat(auto-fit,minmax(260px,1fr))}
  .row-3{grid-template-columns:repeat(auto-fit,minmax(180px,1fr))}

  /* Camera frame */
  #cameraFrame{display:flex;flex-direction:column;align-items:center;gap:12px}
  #cameraCircle{position:relative;width:320px;height:320px;border-radius:999px;border:2px solid var(--gold);overflow:hidden;background:#000;box-shadow:0 12px 28px rgba(0,0,0,.18)}
  #cameraCircle::before{content:"";position:absolute;inset:-4px;border-radius:999px;border:2px solid rgba(200,163,74,.45);animation:breath 1.6s ease-in-out infinite}
  @keyframes breath{0%,100%{transform:scale(1);opacity:.85}50%{transform:scale(1.02);opacity:1}}
  video,canvas,#photoPreview{width:100%;height:100%;object-fit:cover}
  #photoPreview{display:none;border-radius:999px}
  #lightWarning{display:none;background:#d06565;color:#fff;padding:6px 12px;border-radius:8px}

  /* Chips */
  .chips{display:flex;gap:8px;flex-wrap:wrap}
  .chip{position:relative;padding:8px 12px;border:1px solid #e8e8e8;border-radius:999px;background:#fff;cursor:pointer;transition:transform .18s ease, border-color .18s ease}
  .chip.on{border-color:var(--gold);color:var(--gold)}
  .chip:active{transform:scale(.98)}
  .ripple{position:absolute;border-radius:50%;transform:scale(0);background:rgba(200,163,74,.18);animation:ripple .45s linear}
  @keyframes ripple{to{transform:scale(12);opacity:0}}

  /* Accordion & editable */
  .accordion{border:1px solid #eee;border-radius:14px;overflow:hidden;margin-bottom:12px}
  .acc-header{padding:14px;background:var(--soft-gray);font-weight:700;cursor:pointer}
  .acc-body{padding:14px;display:none;background:#fff;line-height:1.6}
  .editable{transition:background-color .2s ease}
  .editable.editing{background:linear-gradient(180deg,#fff, #fff7f0)}
  .saved-tick{position:absolute;right:10px;top:8px;color:var(--gold);opacity:0;transition:opacity .2s}

  /* Loader */
  .loader{height:4px;width:100%;background:linear-gradient(90deg,rgba(200,163,74,.15),rgba(238,217,166,.15));overflow:hidden;border-radius:3px}
  .loader::before{content:"";display:block;height:100%;width:40%;background:linear-gradient(90deg, transparent, rgba(200,163,74,.45), transparent);animation:load 1.4s infinite ease}
  @keyframes load{0%{transform:translateX(-100%)}100%{transform:translateX(260%)}}

  /* Modal */
  .modal{display:none;position:fixed;inset:0;background:rgba(0,0,0,.35);align-items:center;justify-content:center;z-index:999}
  .card{background:#fff;border-radius:16px;box-shadow:0 10px 32px rgba(0,0,0,.18);padding:16px;max-width:720px;width:94vw}

  /* Print */
  .report-wrap{background:var(--beige);padding:18px;border-radius:14px}
  .report{background:#fff;border:1px solid #eee;border-radius:14px;padding:18px;position:relative}
  .report.reveal::before{content:"";position:absolute;inset:0;border:2px solid var(--gold);border-radius:14px;opacity:0;animation:reveal .28s ease forwards}
  @keyframes reveal{from{opacity:0}to{opacity:1}}
  .small{font-size:12px;color:#6b7280}
  .badge{display:inline-block;padding:2px 6px;border-radius:999px;background:#f0f0f0;font-size:11px}
  .fadeOut{animation:fadeOut .24s ease both}
  @keyframes fadeOut{to{opacity:0;transform:translateY(8px)}}
  </style>
</head>
<body>
  <header class="nav">
    <div class="inner">
      <div class="brand" role="button" tabindex="0" aria-label="Go home" id="brandHome">
        <div class="logo"></div>
        <div class="wordmark">Lune Beauty</div>
      </div>
      <div class="nav-spacer"></div>
      <div class="nav-links">
        <a href="index.html">Main Page</a>
        <a href="dashboard.html">Staff</a>
      </div>
    </div>
  </header>

  <!-- discreet admin button bottom-center -->
  <div id="adminHiddenBtn" aria-label="Admin">Staff (Admin)</div>

  <!-- Consent Modal (kept from Luxe v1, summons via Start) -->
  <div id="gdprModal" class="modal" role="dialog" aria-modal="true" aria-labelledby="gdprTitle">
    <div class="card">
      <div style="display:flex;align-items:center;justify-content:space-between;gap:12px;border-bottom:1px solid #eee;padding-bottom:8px;margin-bottom:12px">
        <h3 id="gdprTitle" style="margin:0">Consent</h3>
        <button type="button" class="btn btn-secondary" id="gdprClose">Close</button>
      </div>
      <div>
        <p style="line-height:1.5">By clicking <strong>Start</strong>, I consent to process my photo and inputs for a personalized skin analysis. Photos are processed locally or per your settings. They are not stored on a server.</p>
        <div style="display:flex;gap:8px;justify-content:flex-end;margin-top:10px">
          <button type="button" class="btn btn-primary" id="gdprAgree">I Agree & Continue</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Splash -->
  <section id="splash">
    <div class="logo-big"></div>
    <h1 style="margin:0">Lune Beauty — Skin AI</h1>
    <p class="tag">Luxuriöse Behandlungen & moderne Hautanalyse.</p>
    <button type="button" class="btn btn-primary" id="startApp">Start</button>
  </section>

  <!-- App (original DermAlidaBeauty structure preserved) -->
  <main id="app">
    <div id="progressWrap"><div id="progressBar"><div id="progressFill"></div></div></div>

    <!-- Screen 1: Camera -->
    <section class="screen" id="scr1">
      <h2>Foto aufnehmen</h2>
      <div id="cameraFrame">
        <div id="cameraCircle">
          <video id="video" autoplay playsinline muted></video>
          <canvas id="canvas" style="display:none"></canvas>
          <img id="photoPreview" alt="Preview" />
        </div>
        <div class="loader" id="camLoader" style="display:none;width:320px"></div>
        <div style="display:flex;gap:10px;flex-wrap:wrap;margin-top:8px">
          <button type="button" class="btn btn-secondary" id="startCam">Kamera starten</button>
          <button type="button" class="btn btn-primary" id="capture">Aufnehmen</button>
          <label class="btn btn-secondary" for="uploadImg" style="cursor:pointer">Upload</label>
          <input id="uploadImg" type="file" accept="image/*" style="display:none" />
        </div>
        <div id="lightWarning">Beleuchtung ist zu niedrig</div>
      </div>
      <div style="display:flex;gap:10px;margin-top:12px">
        <button type="button" class="btn btn-primary" data-next="2">Weiter</button>
      </div>
    </section>

    <!-- Screen 2: Intake (unchanged semantics, localized labels kept minimal) -->
    <section class="screen" id="scr2">
      <h2>Details</h2>
      <div class="row row-2">
        <div><label>Skin Type</label><select id="skinType"><option>Normal</option><option>Dry</option><option>Oily</option><option>Combination</option><option>Sensitive</option></select></div>
        <div><label>Allergies</label><div id="allergyChips" class="chips"></div><input id="allergiesOther" placeholder="Other…" style="margin-top:8px;display:none" /></div>
        <div><label>Budget</label><select id="budget"><option value="low">Budget</option><option value="medium" selected>Standard</option><option value="high">Premium</option></select></div>
        <div><label>Name</label><input id="name" placeholder="Optional" /></div>
        <div><label>Age</label><input id="age" type="number" min="1" max="110" placeholder="Optional" /></div>
        <div><label>Gender</label><select id="gender"><option>Prefer not to say</option><option>Female</option><option>Male</option><option>Other</option></select></div>
        <div><label>Email</label><input id="email" type="email" placeholder="Optional" /></div>
      </div>
      <div class="row row-3">
        <div><label>Priority 1</label><select id="priority1"></select></div>
        <div><label>Priority 2</label><select id="priority2"></select></div>
        <div><label>Priority 3</label><select id="priority3"></select></div>
      </div>
      <div class="row row-2">
        <div><label>Morning</label><select id="routineMorning"><option>No routine</option><option>Cleanser only</option><option>Cleanser + moisturizer (Cream)</option><option>Cleanser + moisturizer (Cream) + SPF</option><option>Full routine (cleanser, serum, moisturizer, SPF)</option></select></div>
        <div><label>Evening</label><select id="routineEvening"><option>No routine</option><option>Cleanser only</option><option>Cleanser + moisturizer (Cream)</option><option>Cleanser + serum + moisturizer (Cream)</option><option>Full routine (cleanser, actives, moisturizer)</option></select></div>
        <div><label>Weekly</label><select id="routineWeekly"><option>None</option><option>Exfoliation 1× weekly</option><option>Exfoliation 2× weekly</option><option>Hydrating mask weekly</option><option>Exfoliation + mask weekly</option></select></div>
      </div>
      <div style="display:flex;gap:10px;margin-top:12px;flex-wrap:wrap">
        <button type="button" class="btn btn-primary" id="btnSend">Schnell‑Analyse</button>
        <button type="button" class="btn btn-secondary" data-prev="1">Zurück</button>
        <a class="btn btn-primary" href="dashboard.html">Weiter <span class="badge">Staff</span></a>
      </div>
    </section>

    <!-- Remaining original Luxe v1 screens omitted for brevity in UI; functionality kept in script. -->
    <section class="screen" id="scr7">
      <h2>Computed Skin Analysis</h2>
      <div class="report-wrap"><div class="report" id="compReportArea"></div></div>
      <div style="display:flex;gap:10px;margin-top:12px;flex-wrap:wrap">
        <button type="button" class="btn btn-primary" onclick="window.print()">Print / Save PDF</button>
        <a href="index.html" class="btn btn-secondary">Zur Hauptseite</a>
      </div>
    </section>
  </main>

  <script>
  const $=id=>document.getElementById(id);
  const qsa=(s,c=document)=>Array.from(c.querySelectorAll(s));
  let current=1,total=9;function updateProgress(){const pf=$('progressFill'); if(pf) pf.style.width=((Math.max(0,current-1))/(total-1))*100+'%';}
  function showScreen(i){ qsa('.screen').forEach(s=>s.style.display='none'); const el=$('scr'+i); if(el){ el.style.display='block'; } updateProgress(); if(i===7){ renderPatientResult(); } }
  function goTo(i){ current=i+1; showScreen(i); }
  function toLanding(){ $('app').style.display='none'; $('splash').style.display='flex'; const pf=$('progressFill'); if(pf) pf.style.width='0%'; current=1; }

  // Consent open on Start
  (function(){ const start=$('startApp'); const agree=$('gdprAgree'); const close=$('gdprClose'); const modal=$('gdprModal');
    function open(){ if(modal) modal.style.display='flex'; }
    if(start) start.addEventListener('click', open);
    if(agree) agree.onclick=()=>{ if(modal) modal.style.display='none'; $('splash').style.display='none'; $('app').style.display='block'; current=2; showScreen(1); };
    if(close) close.onclick=()=>{ if(modal) modal.style.display='none'; };
  })();

  // Brand click -> back to index
  (function(){ const b=$('brandHome'); if(!b) return; const handler=()=>{ window.location.href='index.html'; }; b.addEventListener('click', handler); b.addEventListener('keydown', e=>{ if(e.key==='Enter' || e.key===' '){ e.preventDefault(); handler(); } }); })();

  // Admin hidden -> dashboard
  (function(){ const a=$('adminHiddenBtn'); if(a) a.onclick=()=>{ window.location.href='dashboard.html'; }; })();

  // Camera minimal (start/stop)
  let stream; const video=$('video'); const canvas=$('canvas'); const ctx=canvas.getContext('2d'); const preview=$('photoPreview');
  if($('startCam')) $('startCam').onclick = async () => { const loader=$('camLoader'); if(stream){ stopCamera(); $('startCam').textContent='Kamera starten'; return; } try { if(loader) loader.style.display='block'; stream = await navigator.mediaDevices.getUserMedia({video:{facingMode:'user'}}); if(video){ video.srcObject = stream; await video.play(); } if(preview){ preview.style.display='none'; } if(video){ video.style.display='block'; } $('startCam').textContent='Kamera stoppen'; } catch(e){ alert('Kamera nicht verfügbar. Bitte Foto hochladen.'); } finally{ if(loader) loader.style.display='none'; } };
  if($('capture')) $('capture').onclick=()=>{ if(!(video && (video.videoWidth>0))){ alert('Kamera starten oder Foto hochladen.'); return; } canvas.width=video.videoWidth; canvas.height=video.videoHeight; ctx.drawImage(video,0,0); const data=canvas.toDataURL('image/png'); try{ sessionStorage.setItem('clientPhoto', data); }catch(e){} if(preview){ preview.src=data; preview.style.display='block'; } if(video){ video.style.display='none'; }
    if(navigator.vibrate){ try{ navigator.vibrate(8);}catch(e){} }
  };
  if($('uploadImg')) $('uploadImg').onchange=e=>{ const f=e.target.files && e.target.files[0]; if(!f) return; const reader=new FileReader(); reader.onload=(ev)=>{ const data=ev.target.result; try{ sessionStorage.setItem('clientPhoto', data); }catch(e){} if(preview){ preview.src=data; preview.style.display='block'; } if(video){ video.style.display='none'; } }; reader.readAsDataURL(f); };
  function stopCamera(){ if(stream && stream.getTracks){ stream.getTracks().forEach(t=>t.stop()); } stream=null; if(video){ video.srcObject=null; video.style.display='none'; } }

  // Allergy chips
  const ALLERGY_OPTIONS=["None","Fragrance","Lanolin","Nickel","Sulfates","Preservatives","Other"]; const selectedAllergies=new Set();
  function renderAllergyChips(){ const wrap=$('allergyChips'); if(!wrap) return; const opts=[...new Set(ALLERGY_OPTIONS)]; wrap.innerHTML=opts.map(a=>`<span class="chip" data-val="${a}">${a}</span>`).join('');
    wrap.querySelectorAll('.chip').forEach(ch=>{ ch.onclick=(ev)=>{ const val=ch.getAttribute('data-val'); if(val==='None'){ selectedAllergies.clear(); selectedAllergies.add('None'); wrap.querySelectorAll('.chip').forEach(c=>c.classList.remove('on')); ch.classList.add('on'); $('allergiesOther').style.display='none'; return; }
      if(selectedAllergies.has('None')) selectedAllergies.delete('None');
      if(selectedAllergies.has(val)){ selectedAllergies.delete(val); ch.classList.remove('on'); } else { selectedAllergies.add(val); ch.classList.add('on'); }
      $('allergiesOther').style.display = selectedAllergies.has('Other') ? 'block' : 'none';
    }; }); }
  function readAllergies(){ const arr=[...selectedAllergies]; if(arr.includes('Other')){ const o=($('allergiesOther')?.value||'').trim(); if(o) arr.push(o); } return arr.length?arr:['None']; }

  // Priority dropdowns
  const PRIOR_STD=['Acne','Blackheads','Dark spots','Uneven tone','Fine lines','Wrinkles','Enlarged pores','Dryness'];
  const PRIOR_PREM=['Acne','Breakout control','Dark spots','Hyperpigmentation','Uneven tone','Fine lines','Wrinkles','Firmness','Texture refining','Enlarged pores','Hydration','Sensitivity'];
  function getBudgetTier(){ return $('budget').value; }
  function buildPriorityDropdowns(){ const isPremium=getBudgetTier()==='high'; const list=isPremium?PRIOR_PREM:PRIOR_STD; ['priority1','priority2','priority3'].forEach(id=>{ const sel=$(id); if(!sel) return; const prev=sel.value; sel.innerHTML='<option value="">—</option>'+list.map(x=>`<option>${x}</option>`).join(''); if(prev && [...sel.options].some(o=>o.value===prev)) sel.value=prev; }); }

  // Quick analysis (same placeholders as source)
  function simulatedFaceAnalysis(){ return { text:'(photo summary if captured)', metrics:{brightness:120, redness:8, variance:50} }; }
  function deriveAvoidList(type,allergies){ const av=[]; const al=(allergies||'').toLowerCase(); if(type==='Sensitive'){ av.push('Fragrance and essential oils'); av.push('High‑percentage acids on consecutive days'); } if(type==='Dry'){ av.push('High alcohol toners & over‑exfoliation'); } if(type==='Oily' || type==='Combination'){ av.push('Heavy occlusives on T‑zone'); } if(al.includes('fragrance')) av.push('Fragrance (per allergy)'); if(al.includes('lanolin')) av.push('Lanolin derivatives'); if(al.includes('nickel')) av.push('Nickel‑releasing tools'); if(al.includes('sulfate')) av.push('Strong sulfates in cleansers'); if(al.includes('preservative')) av.push('Known sensitizing preservatives'); return av.length?av:["None noted based on your inputs."]; }
  function skinScoreFrom(metrics, inputs){ const clamp=(v,min,max)=>Math.max(min,Math.min(max,v)); const {brightness, redness, variance} = metrics || {brightness:120, redness:8, variance:50}; const target=125, span=100; const brightScore = clamp(100 - Math.abs(brightness-target)/span*100, 0, 100); const redNorm = clamp(redness/80, 0, 1); const redScore = clamp(100*(1 - redNorm), 0, 100); const varNorm = clamp(variance/200, 0, 2); const texScore = clamp(100*(1 - Math.min(varNorm,1)), 0, 100); const rm=(inputs.routines?.morning||'').toLowerCase(); const re=(inputs.routines?.evening||'').toLowerCase(); const rw=(inputs.routines?.weekly||'').toLowerCase(); let routineScore = 0; if(rm.includes('spf')) routineScore += 8; if(re.includes('retino') || re.includes('retinal')) routineScore += 4; if(rw.includes('exfol')) routineScore += 2; routineScore = clamp(routineScore, 0, 12) * (100/12); const total = (brightScore*0.25) + (redScore*0.30) + (texScore*0.35) + (routineScore*0.10); const score = Math.round(clamp(total,0,100)); const band = score>=75?'good':(score>=55?'fair':'poor'); return {score, band, parts:{Brightness:Math.round(brightScore), Redness:Math.round(redScore), Texture:Math.round(texScore), Routine:Math.round(routineScore)}}; }

  if($('btnSend')) $('btnSend').onclick= async ()=>{
    computeAndStoreQuickResult(); goTo(7);
  };
  function computeAndStoreQuickResult(){ const name=$('name').value||'-'; const age=$('age').value||'-'; const gender=$('gender').value||'-'; const skinType=$('skinType').value||'-'; const allergiesArr=readAllergies(); const allergies=allergiesArr.join(', '); const budget=$('budget').value||'-'; const p1=$('priority1').value||''; const p2=$('priority2').value||''; const p3=$('priority3').value||''; const routines={morning:$('routineMorning').value||'-', evening:$('routineEvening').value||'-', weekly:$('routineWeekly').value||'-'}; const today=new Date().toLocaleDateString(); const {text:photoSummary, metrics} = simulatedFaceAnalysis(); const avoid=deriveAvoidList(skinType, allergies); const scoreObj=skinScoreFrom(metrics,{routines}); const payload={name,age,gender,skinType,allergies,budget,priorities:[p1,p2,p3],routines,today,skinScore:scoreObj}; try{ sessionStorage.setItem('computedPatientResultOBJ', JSON.stringify(payload)); }catch(e){}
    const html=`<div><h1 style="margin:0;font-family:'Playfair Display',serif;">Computed Skin Analysis</h1><div class="small">${today} • ${name}</div>
    <div class="section"><strong>Skin Health Score:</strong> ${scoreObj.score}/100 (${scoreObj.band}) — Brightness ${scoreObj.parts.Brightness} · Redness ${scoreObj.parts.Redness} · Texture ${scoreObj.parts.Texture} · Routine ${scoreObj.parts.Routine}</div>
    <div class="section"><strong>Photo summary:</strong> ${photoSummary}</div>
    <div class="section"><strong>Current routine:</strong> Morning ${routines.morning}; Evening ${routines.evening}; Weekly ${routines.weekly}</div>
    <div class="section"><strong>Avoid:</strong> ${avoid.join(', ')}</div></div>`; try{ sessionStorage.setItem('computedPatientResultHTML', html);}catch(e){} }
  function renderPatientResult(){ const area=$('compReportArea'); if(area) area.innerHTML=sessionStorage.getItem('computedPatientResultHTML')||'<p>(No data)</p>'; }

  // Simple nav buttons
  qsa('[data-next]').forEach(b=>{ b.addEventListener('click',()=>{ const i=parseInt(b.getAttribute('data-next'),10); goTo(i); }); });
  qsa('[data-prev]').forEach(b=>{ b.addEventListener('click',()=>{ const i=parseInt(b.getAttribute('data-prev'),10); goTo(i); }); });

  window.addEventListener('load', ()=>{ renderAllergyChips(); buildPriorityDropdowns(); });
  </script>
</body>
</html>
